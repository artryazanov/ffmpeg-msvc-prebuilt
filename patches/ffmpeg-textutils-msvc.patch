diff --git a/libavfilter/textutils.c b/libavfilter/textutils.c
--- a/libavfilter/textutils.c
+++ b/libavfilter/textutils.c
@@ -33,6 +33,20 @@
 #include "libavutil/mem.h"
 #include "libavutil/time.h"
 
+#ifdef _MSC_VER
+#include <time.h>
+static inline struct tm *localtime_r(const time_t *timep, struct tm *result) {
+    if (localtime_s(result, timep) == 0)
+        return result;
+    return NULL;
+}
+static inline struct tm *gmtime_r(const time_t *timep, struct tm *result) {
+    if (gmtime_s(result, timep) == 0)
+        return result;
+    return NULL;
+}
+#endif
+
 static int ff_expand_text_function_internal(FFExpandTextContext *expand_text, AVBPrint *bp,
                                             char *name, unsigned argc, char **argv)
 {
